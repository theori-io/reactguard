# SPDX-FileCopyrightText: 2025 Theori Inc.
# SPDX-License-Identifier: AGPL-3.0-or-later

"""Generic RSC multi-action interpreter for CVE-2025-55182."""

from __future__ import annotations

from dataclasses import dataclass

from .base import Rule
from .multi_action import (
    MultiActionAnalyzer,
    MultiActionContext,
    _default_rule,
    _rule_error_messages,
    _rule_html_only_responses,
    _rule_multiple_digests,
    _rule_prototype_errors,
    _rule_rsc_processing_only,
    _rule_rsc_validation_without_success,
    _rule_safe_args_no_invoke,
    _rule_server_actions_error_path,
    _rule_server_actions_missing,
    _rule_single_digest_failure,
    _rule_single_probe_guard,
    _rule_structural_divergence,
    _rule_success_path,
    _rule_validation_non_rsc,
)


@dataclass
class GenericRscInterpreter(MultiActionAnalyzer):
    framework: str = "rsc"

    def rules(self) -> list[Rule[MultiActionContext]]:
        return [
            _rule_server_actions_missing,
            _rule_rsc_validation_without_success,
            _rule_html_only_responses,
            _rule_safe_args_no_invoke,
            _rule_success_path,
            _rule_prototype_errors,
            _rule_multiple_digests,
            _rule_single_digest_failure,
            _rule_structural_divergence,
            _rule_server_actions_error_path,
            _rule_single_probe_guard,
            _rule_validation_non_rsc,
            _rule_error_messages,
            _rule_rsc_processing_only,
            _default_rule,
        ]
