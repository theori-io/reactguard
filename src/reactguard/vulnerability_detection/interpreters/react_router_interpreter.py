from __future__ import annotations

"""
ReactGuard, framework- and vulnerability-detection tooling for CVE-2025-55182 (React2Shell).
Copyright (C) 2025  Theori Inc.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
"""

"""React Router-specific multi-action interpreter for CVE-2025-55182."""

from dataclasses import dataclass

from .base import Rule
from .multi_action import (
    MultiActionAnalyzer,
    MultiActionContext,
    _default_rule,
    _rule_error_messages,
    _rule_html_only_responses,
    _rule_multiple_digests,
    _rule_prototype_errors,
    _rule_rsc_processing_only,
    _rule_rsc_validation_without_success,
    _rule_safe_args_no_invoke,
    _rule_server_actions_error_path,
    _rule_server_actions_missing,
    _rule_single_digest_failure,
    _rule_single_probe_guard,
    _rule_structural_divergence,
    _rule_success_path,
    _rule_validation_non_rsc,
)


@dataclass
class ReactRouterInterpreter(MultiActionAnalyzer):
    framework: str = "react-router"

    def rules(self) -> list[Rule[MultiActionContext]]:
        return [
            _rule_server_actions_missing,
            _rule_rsc_validation_without_success,
            _rule_html_only_responses,
            _rule_safe_args_no_invoke,
            _rule_success_path,
            _rule_prototype_errors,
            _rule_multiple_digests,
            _rule_single_digest_failure,
            _rule_structural_divergence,
            _rule_server_actions_error_path,
            _rule_single_probe_guard,
            _rule_validation_non_rsc,
            _rule_error_messages,
            _rule_rsc_processing_only,
            _default_rule,
        ]
