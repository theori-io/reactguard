# SPDX-FileCopyrightText: 2025 Theori Inc.
# SPDX-License-Identifier: AGPL-3.0-or-later

from __future__ import annotations

from typing import Any

from ...utils.context import scan_cache

_RESOLVER_CACHE_KEY = "rsc_surface_resolver_cache"


def resolver_cache() -> dict[str, Any]:
    """
    Return the per-scan resolver cache.

    This intentionally lives in `scan_context().extra` so multiple detectors/CVEs within the same scan
    can reuse discovery work (bounded crawls, endpoint discovery, etc.).
    """
    return scan_cache("resolver", legacy_key=_RESOLVER_CACHE_KEY)


def cache_key(*parts: str) -> str:
    return "::".join([p for p in parts if p])


__all__ = ["cache_key", "resolver_cache"]
